{% extends "base.html" %}

{% block head_end %}
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
{% endblock %}

{% block content %}

  <main id="content" role="main">
    <div class="row back">
      <div class="large-1 columns">
      <p><a href="{{url_for('frontend.search', location=location, establishment_name=premises.entry.name)}}"><i class="fa fa-caret-left"></i>Back</a></p>
      </div>
    </div>

    <div class="row rating-header">
      <div class="large-12 columns">
        <h1 class="heading-large"><span class="business">{{premises.entry.name}}</span><span class="rating-id"> - {{food_premises_rating}}</span></h1>
      </div>
    </div>

    <div class="row rating">
      <div class="large-4 columns">
        <p><img src="{{ asset_path }}images/ratings/rating-{{rating.entry['food-premises-rating-value']}}.png"/></p>
      </div>
      <div class="large-7 columns end">
        <h2 class="heading-medium">Premises details</h2>
        <p>{{rating.premises}}</p>
        <p>Premises number: <a href="http://www.2010.voa.gov.uk/rli/en/advanced/assessment-history/2010/{{premises.entry.premises}}">{{premises.entry.premises}}</a></p>
        <h2 class="heading-medium">Local authority</h2>
        <img src="/static/images/camden-logo-black.png" class="local-authority-logo">
      </div>
    </div>

    <div class="row map-canvas">
      <div class="large-9 large-offset-4 columns">
        <div id="map-canvas"></div>
      </div>
    </div>

    <div class="row" class="inspection-details">
      <div class="large-7 columns large-offset-4">
        <h2 class="heading-medium">Inspection details</h2>

        <h2 class="heading-small">Food Hygiene Rating</h2>
        <p class="food-hygiene-rating">{{ rating.entry | format_inspection }}</p>

        <h2 class="heading-small">Date of inspection</h2>
        <p>{{rating.entry['start-date']}}</p>

        <h2 class="heading-small">Inspected by</h2>
        <p><a href="{{ food_premises['local-authority-website'] }}">{{food_premises['local-authority-name']}} Council</a></p>

        {% if premises.entry.inspection_history %}
        <p>
          <ul class="accordion" data-accordion>
            <li class="accordion-navigation">
              <a href="#history">+ full inspection history</a>
              <div id="history" class="content">
                <dl>
                {% for inspection in premises.entry.inspection_history %}
                  <dt><a href="{{inspection['food_premises_rating']}}">{{inspection.start_date}}</a><dt>
                  <dd>{{ inspection | format_inspection}}</dd>
                {% endfor %}
                </dl>
              </div>
            </li>
          </ul>
        </p>
        {% endif %}

        <h2 class="heading-small">Rating breakdown:</h2>
        <ul>
          <li><h3 class="heading-small">Hygienic food handling</h3>
            <p>Hygienic handling of food including preparation, cooking,
          re-heating, cooling and storage. </p>
            <span class="inspection-result">Score: {{ rating.entry['food-premises-rating-hygiene-score'] }} — Improvement necessary</span>
          </li>
          <li>
            <h3 class="heading-small">Cleanliness and condition of facilities and building</h3>
            <p>Cleanliness and condition of facilities and building (including
          having appropriate layout, ventilation, hand washing facilities
          and pest control) to enable good food hygiene.</p>
            <span class="inspection-result">Score: {{ rating.entry['food-premises-rating-structural-score'] }} — Major improvement necessary</p>
          </li>
          <li>
            <h3 class="heading-small">Management of food safety</h3>
            <p>System or checks in place to ensure that food sold or served is
          safe to eat, evidence that staff know about food safety, and the
          food safety officer has confidence that standards will be
          maintained in future.</p>
            <span class="inspection-result">Score: {{ rating.entry['food-premises-rating-confidence-in-management-score'] }} — Major improvement necessary</span>
          </li>
        </ul>
        {% if rating.entry['food-premises-rating-reply']  %}
        <h2 class="heading-medium">What the business says</h2>
        <div class="response">
          <p>{{rating.entry['food-premises-rating-reply'] | format_reply | safe }}</p>
        </div>
        {% endif %}

        <h2 class="heading-medium">Company details</h2>
        <div class="row">
          <table class="company-details">
            <tbody>
              <tr><td>Company name:</td><td>{{company.company_name}}</td></tr>
              <tr><td>Company number:</td><td><a href="https://beta.companieshouse.gov.uk/company/{{premises.entry.business | format_curie }}">{{premises.entry.business | format_curie }}</a></td></tr>
              <tr><td>Head office:</td><td>{{company.registered_office_address.address_line_1}},{{company.registered_office_address.locality}}, {{company.registered_office_address.country}} {{company.registered_office_address.postal_code}}</td></tr>
              <tr><td>Industry:</td><td><a href="http://industry.openregister.org/industry/{{company.industry }}">{{company.industry}}</a> — {{company['industry-name']}}</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </main>

  <div class="row register-links">
    <div class="large-7 columns large-offset-4"">
        <h2 class="heading-small">This page uses data from the following registers:</h2>
        <div id="registers" class="content">
          <ul>
            <li><a href="http://food-premises-rating.openregister.org/food-premises-rating/{{rating.entry['food-premises-rating']}}">Food premises rating</a></li>
            <li><a href="http://food-premises.openregister.org/food-premises/{{premises.entry['food-premises']}}">Food premises</a></li>
            <li><a href="http://premises.prod.openregister.org/premises/{{premises.entry['premises']}}">Premises</a></li>
            <li><a href="http://local-authority.openregister.org/local-authority/{{premises.entry['local-authority']}}">Local authority</a></li>
            <li><a href="http://company.openregister.org/company/{{premises.entry.business | format_curie }}">Company</a></li>
            <li><a href="http://industry.openregister.org/industry/{{company.industry }}">Industry</a></li>
        </ul>
      </div>
    </div>
  </div>

  {% include "footer.html" %}
{% endblock %}

{% block body_end %}

<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script>
var map = L.map('map-canvas').setView([ {{ latitude }}, {{longitude }}], 17);
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
map.scrollWheelZoom.disable();
L.marker([ {{ latitude }}, {{longitude }}]).addTo(map)
</script>
{% endblock %}
